"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.sort=sort;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_marked=_regenerator.default.mark(makeAscendingRun),_marked2=_regenerator.default.mark(reverseRun),_marked3=_regenerator.default.mark(gallopLeft),_marked4=_regenerator.default.mark(gallopRight),_marked5=_regenerator.default.mark(sort),DEFAULT_MIN_MERGE=32,YIELD_FREQ=63,DEFAULT_MIN_GALLOPING=7,DEFAULT_TMP_STORAGE_LENGTH=256,POWERS_OF_TEN=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9];function log10(x){return 1e5>x?100>x?10>x?0:1:1e4>x?1e3>x?2:3:4:1e7>x?1e6>x?5:6:1e9>x?1e8>x?7:8:9}function alphabeticalCompare(a,b){if(a===b)return 0;if(~~a===a&&~~b===b){if(0===a||0===b)return a<b?-1:1;if(0>a||0>b){if(0<=b)return-1;if(0<=a)return 1;a=-a,b=-b}var al=log10(a),bl=log10(b),t=0;return al<bl?(a*=POWERS_OF_TEN[bl-al-1],b/=10,t=-1):al>bl&&(b*=POWERS_OF_TEN[al-bl-1],a/=10,t=1),a===b?t:a<b?-1:1}var aStr=a+"",bStr=b+"";return aStr===bStr?0:aStr<bStr?-1:1}function minRunLength(n){for(var r=0;n>=DEFAULT_MIN_MERGE;)r|=1&n,n>>=1;return n+r}function makeAscendingRun(array,lo,hi,compare){var runHi;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(runHi=lo+1,runHi!==hi){_context.next=3;break}return _context.abrupt("return",1);case 3:if(!(0>compare(array[runHi++],array[lo]))){_context.next=14;break}case 4:if(!(runHi<hi&&0>compare(array[runHi],array[runHi-1]))){_context.next=11;break}if(runHi++,0!=(runHi&YIELD_FREQ)){_context.next=9;break}return void(_context.next=9);case 9:_context.next=4;break;case 11:return _context.delegateYield(reverseRun(array,lo,runHi),"t0",12);case 12:_context.next=21;break;case 14:if(!(runHi<hi&&0<=compare(array[runHi],array[runHi-1]))){_context.next=21;break}if(runHi++,0!=(runHi&YIELD_FREQ)){_context.next=19;break}return void(_context.next=19);case 19:_context.next=14;break;case 21:return _context.abrupt("return",runHi-lo);case 22:case"end":return _context.stop();}},_marked)}function reverseRun(array,lo,hi){var t;return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:hi--;case 1:if(!(lo<hi)){_context2.next=10;break}if(t=array[lo],array[lo++]=array[hi],array[hi--]=t,0!=(127&hi)){_context2.next=8;break}return void(_context2.next=8);case 8:_context2.next=1;break;case 10:case"end":return _context2.stop();}},_marked2)}function binaryInsertionSort(array,lo,hi,start,compare){for(start===lo&&start++;start<hi;start++){for(var pivot=array[start],left=lo,right=start;left<right;){var mid=left+right>>>1;0>compare(pivot,array[mid])?right=mid:left=mid+1}var n=start-left;switch(n){case 3:array[left+3]=array[left+2];case 2:array[left+2]=array[left+1];case 1:array[left+1]=array[left];break;default:for(;0<n;)array[left+n]=array[left+n-1],n--;}array[left]=pivot}}var yieldCounter=0;function checkYield(){return 0==(yieldCounter++&YIELD_FREQ)}function gallopLeft(value,array,start,length,hint,compare){var lastOffset,maxOffset,offset,tmp,m;return _regenerator.default.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return void(_context3.next=2);case 2:if(lastOffset=0,maxOffset=0,offset=1,!(0<compare(value,array[start+hint]))){_context3.next=21;break}maxOffset=length-hint;case 7:if(!(offset<maxOffset&&0<compare(value,array[start+hint+offset]))){_context3.next=16;break}if(!checkYield()){_context3.next=11;break}return void(_context3.next=11);case 11:lastOffset=offset,offset=(offset<<1)+1,0>=offset&&(offset=maxOffset),_context3.next=7;break;case 16:offset>maxOffset&&(offset=maxOffset),lastOffset+=hint,offset+=hint,_context3.next=35;break;case 21:maxOffset=hint+1;case 22:if(!(offset<maxOffset&&0>=compare(value,array[start+hint-offset]))){_context3.next=31;break}if(!checkYield()){_context3.next=26;break}return void(_context3.next=26);case 26:lastOffset=offset,offset=(offset<<1)+1,0>=offset&&(offset=maxOffset),_context3.next=22;break;case 31:offset>maxOffset&&(offset=maxOffset),tmp=lastOffset,lastOffset=hint-offset,offset=hint-tmp;case 35:lastOffset++;case 36:if(!(lastOffset<offset)){_context3.next=44;break}if(m=lastOffset+(offset-lastOffset>>>1),!checkYield()){_context3.next=41;break}return void(_context3.next=41);case 41:0<compare(value,array[start+m])?lastOffset=m+1:offset=m,_context3.next=36;break;case 44:return _context3.abrupt("return",offset);case 45:case"end":return _context3.stop();}},_marked3)}function gallopRight(value,array,start,length,hint,compare){var lastOffset,maxOffset,offset,tmp,m;return _regenerator.default.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return void(_context4.next=2);case 2:if(lastOffset=0,maxOffset=0,offset=1,!(0>compare(value,array[start+hint]))){_context4.next=22;break}maxOffset=hint+1;case 7:if(!(offset<maxOffset&&0>compare(value,array[start+hint-offset]))){_context4.next=16;break}if(!checkYield()){_context4.next=11;break}return void(_context4.next=11);case 11:lastOffset=offset,offset=(offset<<1)+1,0>=offset&&(offset=maxOffset),_context4.next=7;break;case 16:offset>maxOffset&&(offset=maxOffset),tmp=lastOffset,lastOffset=hint-offset,offset=hint-tmp,_context4.next=35;break;case 22:maxOffset=length-hint;case 23:if(!(offset<maxOffset&&0<=compare(value,array[start+hint+offset]))){_context4.next=32;break}if(!checkYield()){_context4.next=27;break}return void(_context4.next=27);case 27:lastOffset=offset,offset=(offset<<1)+1,0>=offset&&(offset=maxOffset),_context4.next=23;break;case 32:offset>maxOffset&&(offset=maxOffset),lastOffset+=hint,offset+=hint;case 35:lastOffset++;case 36:if(!(lastOffset<offset)){_context4.next=44;break}if(m=lastOffset+(offset-lastOffset>>>1),!checkYield()){_context4.next=41;break}return void(_context4.next=41);case 41:0>compare(value,array[start+m])?offset=m:lastOffset=m+1,_context4.next=36;break;case 44:return _context4.abrupt("return",offset);case 45:case"end":return _context4.stop();}},_marked4)}var TimSort=function(){function TimSort(array,compare){(0,_classCallCheck2.default)(this,TimSort),(0,_defineProperty2.default)(this,"array",null),(0,_defineProperty2.default)(this,"compare",null),(0,_defineProperty2.default)(this,"minGallop",DEFAULT_MIN_GALLOPING),(0,_defineProperty2.default)(this,"length",0),(0,_defineProperty2.default)(this,"tmpStorageLength",DEFAULT_TMP_STORAGE_LENGTH),(0,_defineProperty2.default)(this,"stackLength",0),(0,_defineProperty2.default)(this,"runStart",null),(0,_defineProperty2.default)(this,"runLength",null),(0,_defineProperty2.default)(this,"stackSize",0),this.array=array,this.compare=compare,this.length=array.length,this.length<2*DEFAULT_TMP_STORAGE_LENGTH&&(this.tmpStorageLength=this.length>>>1),this.tmp=Array(this.tmpStorageLength),this.stackLength=120>this.length?5:1542>this.length?10:119151>this.length?19:40,this.runStart=Array(this.stackLength),this.runLength=Array(this.stackLength)}return(0,_createClass2.default)(TimSort,[{key:"pushRun",value:function pushRun(runStart,runLength){this.runStart[this.stackSize]=runStart,this.runLength[this.stackSize]=runLength,this.stackSize+=1}},{key:"mergeRuns",value:_regenerator.default.mark(function mergeRuns(){var n;return _regenerator.default.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(!(1<this.stackSize)){_context5.next=11;break}if(n=this.stackSize-2,!(1<=n&&this.runLength[n-1]<=this.runLength[n]+this.runLength[n+1]||2<=n&&this.runLength[n-2]<=this.runLength[n]+this.runLength[n-1])){_context5.next=6;break}this.runLength[n-1]<this.runLength[n+1]&&n--,_context5.next=8;break;case 6:if(!(this.runLength[n]>this.runLength[n+1])){_context5.next=8;break}return _context5.abrupt("break",11);case 8:return _context5.delegateYield(this.mergeAt(n),"t0",9);case 9:_context5.next=0;break;case 11:case"end":return _context5.stop();}},mergeRuns,this)})},{key:"forceMergeRuns",value:_regenerator.default.mark(function forceMergeRuns(){var n;return _regenerator.default.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(!(1<this.stackSize)){_context6.next=6;break}return n=this.stackSize-2,0<n&&this.runLength[n-1]<this.runLength[n+1]&&n--,_context6.delegateYield(this.mergeAt(n),"t0",4);case 4:_context6.next=0;break;case 6:case"end":return _context6.stop();}},forceMergeRuns,this)})},{key:"mergeAt",value:_regenerator.default.mark(function mergeAt(i){var compare,array,start1,length1,start2,length2,k;return _regenerator.default.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return void(_context7.next=2);case 2:return compare=this.compare,array=this.array,start1=this.runStart[i],length1=this.runLength[i],start2=this.runStart[i+1],length2=this.runLength[i+1],this.runLength[i]=length1+length2,i===this.stackSize-3&&(this.runStart[i+1]=this.runStart[i+2],this.runLength[i+1]=this.runLength[i+2]),this.stackSize--,_context7.delegateYield(gallopRight(array[start2],array,start1,length1,0,compare),"t0",12);case 12:if(k=_context7.t0,start1+=k,length1-=k,0!==length1){_context7.next=17;break}return _context7.abrupt("return");case 17:return _context7.delegateYield(gallopLeft(array[start1+length1-1],array,start2,length2,length2-1,compare),"t1",18);case 18:if(length2=_context7.t1,0!==length2){_context7.next=21;break}return _context7.abrupt("return");case 21:if(!(length1<=length2)){_context7.next=25;break}return _context7.delegateYield(this.mergeLow(start1,length1,start2,length2),"t2",23);case 23:_context7.next=26;break;case 25:return _context7.delegateYield(this.mergeHigh(start1,length1,start2,length2),"t3",26);case 26:case"end":return _context7.stop();}},mergeAt,this)})},{key:"mergeLow",value:_regenerator.default.mark(function mergeLow(start1,length1,start2,length2){var compare,array,tmp,i,cursor1,cursor2,dest,minGallop,count1,count2,exit;return _regenerator.default.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:compare=this.compare,array=this.array,tmp=this.tmp,i=0,i=0;case 5:if(!(i<length1)){_context8.next=13;break}if(!checkYield()){_context8.next=9;break}return void(_context8.next=9);case 9:tmp[i]=array[start1+i];case 10:i++,_context8.next=5;break;case 13:if(cursor1=0,cursor2=start2,dest=start1,array[dest++]=array[cursor2++],0!=--length2){_context8.next=28;break}i=0;case 19:if(!(i<length1)){_context8.next=27;break}if(!checkYield()){_context8.next=23;break}return void(_context8.next=23);case 23:array[dest+i]=tmp[cursor1+i];case 24:i++,_context8.next=19;break;case 27:return _context8.abrupt("return");case 28:if(1!==length1){_context8.next=40;break}i=0;case 30:if(!(i<length2)){_context8.next=38;break}if(!checkYield()){_context8.next=34;break}return void(_context8.next=34);case 34:array[dest+i]=array[cursor2+i];case 35:i++,_context8.next=30;break;case 38:return array[dest+length2]=tmp[cursor1],_context8.abrupt("return");case 40:minGallop=this.minGallop;case 41:count1=0,count2=0,exit=!1;case 45:if(!checkYield()){_context8.next=48;break}return void(_context8.next=48);case 48:if(!(0>compare(array[cursor2],tmp[cursor1]))){_context8.next=57;break}if(array[dest++]=array[cursor2++],count2++,count1=0,0!=--length2){_context8.next=55;break}return exit=!0,_context8.abrupt("break",64);case 55:_context8.next=63;break;case 57:if(array[dest++]=tmp[cursor1++],count1++,count2=0,1!=--length1){_context8.next=63;break}return exit=!0,_context8.abrupt("break",64);case 63:if((count1|count2)<minGallop){_context8.next=45;break}case 64:if(!exit){_context8.next=66;break}return _context8.abrupt("break",121);case 66:if(!checkYield()){_context8.next=69;break}return void(_context8.next=69);case 69:return _context8.delegateYield(gallopRight(array[cursor2],tmp,cursor1,length1,0,compare),"t0",70);case 70:if(count1=_context8.t0,0===count1){_context8.next=87;break}i=0;case 73:if(!(i<count1)){_context8.next=81;break}if(!checkYield()){_context8.next=77;break}return void(_context8.next=77);case 77:array[dest+i]=tmp[cursor1+i];case 78:i++,_context8.next=73;break;case 81:if(dest+=count1,cursor1+=count1,length1-=count1,!(1>=length1)){_context8.next=87;break}return exit=!0,_context8.abrupt("break",115);case 87:if(array[dest++]=array[cursor2++],0!=--length2){_context8.next=91;break}return exit=!0,_context8.abrupt("break",115);case 91:return _context8.delegateYield(gallopLeft(tmp[cursor1],array,cursor2,length2,0,compare),"t1",92);case 92:if(count2=_context8.t1,0===count2){_context8.next=109;break}i=0;case 95:if(!(i<count2)){_context8.next=103;break}if(!checkYield()){_context8.next=99;break}return void(_context8.next=99);case 99:array[dest+i]=array[cursor2+i];case 100:i++,_context8.next=95;break;case 103:if(dest+=count2,cursor2+=count2,length2-=count2,0!==length2){_context8.next=109;break}return exit=!0,_context8.abrupt("break",115);case 109:if(array[dest++]=tmp[cursor1++],1!=--length1){_context8.next=113;break}return exit=!0,_context8.abrupt("break",115);case 113:minGallop--;case 114:if(count1>=DEFAULT_MIN_GALLOPING||count2>=DEFAULT_MIN_GALLOPING){_context8.next=66;break}case 115:if(!exit){_context8.next=117;break}return _context8.abrupt("break",121);case 117:0>minGallop&&(minGallop=0),minGallop+=2,_context8.next=41;break;case 121:if(this.minGallop=minGallop,1>minGallop&&(this.minGallop=1),1!==length1){_context8.next=136;break}i=0;case 125:if(!(i<length2)){_context8.next=133;break}if(!checkYield()){_context8.next=129;break}return void(_context8.next=129);case 129:array[dest+i]=array[cursor2+i];case 130:i++,_context8.next=125;break;case 133:array[dest+length2]=tmp[cursor1],_context8.next=149;break;case 136:if(0!==length1){_context8.next=140;break}throw new Error("mergeLow preconditions were not respected");case 140:i=0;case 141:if(!(i<length1)){_context8.next=149;break}if(!checkYield()){_context8.next=145;break}return void(_context8.next=145);case 145:array[dest+i]=tmp[cursor1+i];case 146:i++,_context8.next=141;break;case 149:case"end":return _context8.stop();}},mergeLow,this)})},{key:"mergeHigh",value:_regenerator.default.mark(function mergeHigh(start1,length1,start2,length2){var compare,array,tmp,i,cursor1,cursor2,dest,customCursor,customDest,minGallop,count1,count2,exit;return _regenerator.default.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:compare=this.compare,array=this.array,tmp=this.tmp,i=0,i=0;case 5:if(!(i<length2)){_context9.next=13;break}if(!checkYield()){_context9.next=9;break}return void(_context9.next=9);case 9:tmp[i]=array[start2+i];case 10:i++,_context9.next=5;break;case 13:if(cursor1=start1+length1-1,cursor2=length2-1,dest=start2+length2-1,customCursor=0,customDest=0,array[dest--]=array[cursor1--],0!=--length1){_context9.next=31;break}customCursor=dest-(length2-1),i=0;case 22:if(!(i<length2)){_context9.next=30;break}if(!checkYield()){_context9.next=26;break}return void(_context9.next=26);case 26:array[customCursor+i]=tmp[i];case 27:i++,_context9.next=22;break;case 30:return _context9.abrupt("return");case 31:if(1!==length2){_context9.next=47;break}dest-=length1,cursor1-=length1,customDest=dest+1,customCursor=cursor1+1,i=length1-1;case 37:if(!(0<=i)){_context9.next=45;break}if(!checkYield()){_context9.next=41;break}return void(_context9.next=41);case 41:array[customDest+i]=array[customCursor+i];case 42:i--,_context9.next=37;break;case 45:return array[dest]=tmp[cursor2],_context9.abrupt("return");case 47:minGallop=this.minGallop;case 48:count1=0,count2=0,exit=!1;case 52:if(!checkYield()){_context9.next=55;break}return void(_context9.next=55);case 55:if(!(0>compare(tmp[cursor2],array[cursor1]))){_context9.next=64;break}if(array[dest--]=array[cursor1--],count1++,count2=0,0!=--length1){_context9.next=62;break}return exit=!0,_context9.abrupt("break",71);case 62:_context9.next=70;break;case 64:if(array[dest--]=tmp[cursor2--],count2++,count1=0,1!=--length2){_context9.next=70;break}return exit=!0,_context9.abrupt("break",71);case 70:if((count1|count2)<minGallop){_context9.next=52;break}case 71:if(!exit){_context9.next=73;break}return _context9.abrupt("break",133);case 73:return _context9.t0=length1,_context9.delegateYield(gallopRight(tmp[cursor2],array,start1,length1,length1-1,compare),"t1",75);case 75:if(_context9.t2=_context9.t1,count1=_context9.t0-_context9.t2,0===count1){_context9.next=95;break}dest-=count1,cursor1-=count1,length1-=count1,customDest=dest+1,customCursor=cursor1+1,i=count1-1;case 84:if(!(0<=i)){_context9.next=92;break}if(!checkYield()){_context9.next=88;break}return void(_context9.next=88);case 88:array[customDest+i]=array[customCursor+i];case 89:i--,_context9.next=84;break;case 92:if(0!==length1){_context9.next=95;break}return exit=!0,_context9.abrupt("break",127);case 95:if(array[dest--]=tmp[cursor2--],1!=--length2){_context9.next=99;break}return exit=!0,_context9.abrupt("break",127);case 99:return _context9.t3=length2,_context9.delegateYield(gallopLeft(array[cursor1],tmp,0,length2,length2-1,compare),"t4",101);case 101:if(_context9.t5=_context9.t4,count2=_context9.t3-_context9.t5,0===count2){_context9.next=121;break}dest-=count2,cursor2-=count2,length2-=count2,customDest=dest+1,customCursor=cursor2+1,i=0;case 110:if(!(i<count2)){_context9.next=118;break}if(!checkYield()){_context9.next=114;break}return void(_context9.next=114);case 114:array[customDest+i]=tmp[customCursor+i];case 115:i++,_context9.next=110;break;case 118:if(!(1>=length2)){_context9.next=121;break}return exit=!0,_context9.abrupt("break",127);case 121:if(array[dest--]=array[cursor1--],0!=--length1){_context9.next=125;break}return exit=!0,_context9.abrupt("break",127);case 125:minGallop--;case 126:if(count1>=DEFAULT_MIN_GALLOPING||count2>=DEFAULT_MIN_GALLOPING){_context9.next=73;break}case 127:if(!exit){_context9.next=129;break}return _context9.abrupt("break",133);case 129:0>minGallop&&(minGallop=0),minGallop+=2,_context9.next=48;break;case 133:if(this.minGallop=minGallop,1>minGallop&&(this.minGallop=1),1!==length2){_context9.next=152;break}dest-=length1,cursor1-=length1,customDest=dest+1,customCursor=cursor1+1,i=length1-1;case 141:if(!(0<=i)){_context9.next=149;break}if(!checkYield()){_context9.next=145;break}return void(_context9.next=145);case 145:array[customDest+i]=array[customCursor+i];case 146:i--,_context9.next=141;break;case 149:array[dest]=tmp[cursor2],_context9.next=166;break;case 152:if(0!==length2){_context9.next=156;break}throw new Error("mergeHigh preconditions were not respected");case 156:customCursor=dest-(length2-1),i=0;case 158:if(!(i<length2)){_context9.next=166;break}if(!checkYield()){_context9.next=162;break}return void(_context9.next=162);case 162:array[customCursor+i]=tmp[i];case 163:i++,_context9.next=158;break;case 166:case"end":return _context9.stop();}},mergeHigh,this)})}]),TimSort}();function sort(array,compare,lo,hi){var itemExtract,remaining,runLength,ts,minRun,force;return _regenerator.default.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:if(Array.isArray(array)){_context10.next=2;break}throw new TypeError("Can only sort arrays");case 2:if(compare?"function"==typeof compare?1===compare.length&&(itemExtract=compare,compare=function(a,b){var va=itemExtract(a),vb=itemExtract(b);return va===vb?0:vb>va?-1:1}):(hi=lo,lo=compare,compare=alphabeticalCompare):compare=alphabeticalCompare,lo||(lo=0),hi||(hi=array.length),remaining=hi-lo,!(2>remaining)){_context10.next=8;break}return _context10.abrupt("return",array);case 8:if(runLength=0,!(remaining<DEFAULT_MIN_MERGE)){_context10.next=16;break}return _context10.delegateYield(makeAscendingRun(array,lo,hi,compare),"t0",11);case 11:return runLength=_context10.t0,binaryInsertionSort(array,lo,hi,lo+runLength,compare),void(_context10.next=15);case 15:return _context10.abrupt("return",array);case 16:ts=new TimSort(array,compare),minRun=minRunLength(remaining);case 18:return _context10.delegateYield(makeAscendingRun(array,lo,hi,compare),"t1",19);case 19:if(runLength=_context10.t1,!(runLength<minRun)){_context10.next=27;break}return force=remaining,force>minRun&&(force=minRun),binaryInsertionSort(array,lo,lo+force,lo+runLength,compare),void(_context10.next=26);case 26:runLength=force;case 27:return ts.pushRun(lo,runLength),_context10.delegateYield(ts.mergeRuns(),"t2",29);case 29:remaining-=runLength,lo+=runLength;case 31:if(0!==remaining){_context10.next=18;break}case 32:return _context10.delegateYield(ts.forceMergeRuns(),"t3",33);case 33:return _context10.abrupt("return",array);case 34:case"end":return _context10.stop();}},_marked5)}